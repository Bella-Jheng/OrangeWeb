{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport React, { useState, useRef } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport Link from \"next/link\";\nimport classes from \"./index.module.css\";\nimport useHttp from \"../../hooks/use-http\";\nimport { useRouter } from \"next/router\";\nimport { useDispatch } from \"react-redux\";\nimport { cartActions } from \"../../store/cart-slice\";\nimport AuthContext from \"../../store/auth-context\";\nimport Banner from \"../../components/layout/Banner\";\nimport Alert from \"../../components/UI/Alert\";\nimport KeyboardArrowDownIcon from \"@mui/icons-material/KeyboardArrowDown\";\nimport Collapse from \"@material-ui/core/Collapse\";\nimport { GreenButton } from \"../../components/UI/Button\";\nimport ShoppingCartIcon from \"@mui/icons-material/ShoppingCart\";\n\nconst index = () => {\n  const {\n    0: formData,\n    1: setFormData\n  } = useState({\n    cartData: {},\n    custData: {}\n  });\n  const authCtx = useContext(AuthContext);\n  const router = useRouter();\n  const dispatch = useDispatch(); //處理訂單對話框\n\n  const {\n    0: alertOpen,\n    1: setAlertOpen\n  } = useState(false);\n\n  const handleAlertOpen = () => {\n    setAlertOpen(true);\n  };\n\n  const handleAlertClose = () => {\n    setAlertOpen(false);\n  }; //購物車內容\n\n\n  const cart = useSelector(state => state.cart);\n  const {\n    isLoading,\n    error,\n    sendRequest\n  } = useHttp();\n  const {\n    0: expanded,\n    1: setExpanded\n  } = useState(false);\n\n  const handleExpandClick = () => {\n    setExpanded(!expanded);\n  }; //清除購物車\n\n\n  const removeFromCartHandler = () => {\n    dispatch(cartActions.removeFromCart({\n      id: \"\",\n      size: \"\"\n    }));\n  }; //訂單資訊\n\n\n  const {\n    0: isFormInvalid,\n    1: setFormIsInvalid\n  } = useState({\n    nameState: false,\n    emailState: false,\n    phoneState: false,\n    cardNumberState: false,\n    cardOwnerState: false,\n    cardDateState: false,\n    saftyNumberState: false,\n    sendWayState: false,\n    sendAddrState: false,\n    sendNameState: false,\n    sendPhoneState: false,\n    recieptTypeState: false,\n    recieptState: false\n  });\n  let formIsValid = false;\n\n  const isEmpty = value => value.trim() === \"\";\n\n  const isThreeChart = value => value.trim().length === 3; //顧客資料\n\n\n  const name = useRef();\n  const email = useRef();\n  const phone = useRef(); //付款資料\n\n  const cardNumber = useRef();\n  const cardOwner = useRef();\n  const cardDate = useRef();\n  const saftyNumber = useRef(); //送貨資料\n\n  const sendWay = useRef();\n  const sendAddr = useRef();\n  const sendName = useRef();\n  const sendPhone = useRef(); //發票\n\n  const recieptType = useRef();\n  const reciept = useRef();\n\n  const comfirmDataHandler = event => {\n    event.preventDefault();\n    const enterName = name.current.value;\n    const enterEmail = email.current.value;\n    const enterPhone = phone.current.value;\n    const enterCardNumber = cardNumber.current.value;\n    const enterCardOwner = cardOwner.current.value;\n    const enterCardDate = cardDate.current.value;\n    const enterSaftyNumber = saftyNumber.current.value;\n    const enterSendWay = sendWay.current.value;\n    const enterSendAddr = sendAddr.current.value;\n    const enterSendName = sendName.current.value;\n    const enterSendPhone = sendPhone.current.value;\n    const enterRecieptType = recieptType.current.value;\n    const enterReciept = reciept.current.value;\n    const enterNameIsInvalid = isEmpty(enterName);\n    const enterEmailIsInvalid = isEmpty(enterEmail);\n    const enterPhoneIsInvalid = isEmpty(enterPhone);\n    const enterCardNumberIsInvalid = isEmpty(enterCardNumber);\n    const enterCardOwnerIsInvalid = isEmpty(enterCardOwner);\n    const enterCardDateIsInvalid = isEmpty(enterCardDate);\n    const enterSaftyNumberIsInvalid = !isThreeChart(enterSaftyNumber);\n    const enterSendWayIsInvalid = isEmpty(enterSendWay);\n    const enterSendAddrIsInvalid = isEmpty(enterSendAddr);\n    const enterSendNameIsInvalid = isEmpty(enterSendName);\n    const enterSendPhoneIsInvalid = isEmpty(enterSendPhone);\n    const enterRecieptTypeIsInvalid = isEmpty(enterRecieptType);\n    const enterRecieptIsInvalid = isEmpty(enterReciept);\n    setFormIsInvalid({\n      nameState: enterNameIsInvalid,\n      emailState: enterEmailIsInvalid,\n      phoneState: enterPhoneIsInvalid,\n      cardNumberState: enterCardNumberIsInvalid,\n      cardOwnerState: enterCardOwnerIsInvalid,\n      cardDateState: enterCardDateIsInvalid,\n      saftyNumberState: enterSaftyNumberIsInvalid,\n      sendWayState: enterSendWayIsInvalid,\n      sendAddrState: enterSendAddrIsInvalid,\n      sendNameState: enterSendNameIsInvalid,\n      sendPhoneState: enterSendPhoneIsInvalid,\n      recieptTypeState: enterRecieptTypeIsInvalid,\n      recieptState: enterRecieptIsInvalid\n    });\n    formIsValid = !enterNameIsInvalid && !enterEmailIsInvalid && !enterPhoneIsInvalid && !enterCardNumberIsInvalid && !enterCardOwnerIsInvalid && !enterCardDateIsInvalid && !enterSaftyNumberIsInvalid && !enterSendWayIsInvalid && !enterSendAddrIsInvalid && !enterSendNameIsInvalid && !enterSendPhoneIsInvalid && !enterRecieptTypeIsInvalid && !enterRecieptIsInvalid;\n\n    if (!formIsValid) {\n      return;\n    }\n\n    setFormData({\n      cartData: {\n        cart\n      },\n      custData: {\n        enterName,\n        enterEmail,\n        enterPhone,\n        enterCardNumber,\n        enterCardOwner,\n        enterCardDate,\n        enterSaftyNumber,\n        enterSendWay,\n        enterSendAddr,\n        enterSendName,\n        enterSendPhone,\n        enterRecieptType,\n        enterReciept\n      }\n    });\n    handleAlertOpen();\n  };\n\n  const onSubmitHandler = () => {\n    const requestData = {\n      url: \"https://react-http-3d73c-default-rtdb.firebaseio.com/orangeorder.json\",\n      method: \"POST\",\n      body: {\n        custToken: authCtx.token ? authCtx.token : null,\n        cartData: formData.cartData,\n        custData: formData.custData\n      }\n    };\n\n    const applyData = responseData => {\n      console.log(requestData);\n    };\n\n    sendRequest(requestData, applyData);\n    removeFromCartHandler();\n    handleAlertClose();\n    router.push(\"/\");\n  };\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: classes.container,\n    children: [/*#__PURE__*/_jsx(Alert, {\n      openAlert: alertOpen,\n      handleClose: handleAlertClose,\n      handleAgree: onSubmitHandler,\n      title: \"\\u9001\\u51FA\\u8A02\\u55AE\",\n      alertContent: \"\\u9001\\u51FA\\u5F8C\\u7121\\u6CD5\\u4FEE\\u6539\\uFF0C\\u78BA\\u5B9A\\u8981\\u9001\\u51FA\\u8A02\\u55AE\\u55CE\\uFF1F\",\n      disagree: true\n    }), /*#__PURE__*/_jsx(Banner, {\n      title: \"\\u8A02\\u55AE\\u78BA\\u8A8D\"\n    }), cart.items.length === 0 ? /*#__PURE__*/_jsx(\"div\", {\n      className: classes.wrapper,\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: classes.cartEmptyContainer,\n        children: [/*#__PURE__*/_jsx(ShoppingCartIcon, {\n          style: {\n            fontSize: 150,\n            color: \"gray\"\n          }\n        }), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsx(Link, {\n          href: \"/product-list\",\n          children: /*#__PURE__*/_jsx(GreenButton, {\n            title: \"\\u7E7C\\u7E8C\\u8CFC\\u7269\",\n            width: \"200px\"\n          })\n        })]\n      })\n    }) : /*#__PURE__*/_jsxs(\"div\", {\n      className: classes.wrapper,\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: classes.cartContainer,\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: classes.cartHeader,\n          onClick: handleExpandClick,\n          children: [/*#__PURE__*/_jsxs(\"h2\", {\n            children: [\"\\u5408\\u8A08: NT$ \", cart.totalPrice]\n          }), /*#__PURE__*/_jsx(KeyboardArrowDownIcon, {})]\n        }), /*#__PURE__*/_jsxs(Collapse, {\n          style: {\n            flex: \"100%\"\n          },\n          in: expanded,\n          timeout: \"auto\",\n          unmountOnExit: true,\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: classes.column,\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: classes.cartMainPart,\n              children: \"\\u5546\\u54C1\\u8CC7\\u6599\"\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: classes.cartInfor,\n              children: \"\\u55AE\\u4EF6\\u50F9\\u683C\"\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: classes.cartInfor,\n              children: \"\\u6578\\u91CF\"\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: classes.cartInfor,\n              children: \"\\u5C0F\\u8A08\"\n            })]\n          }), cart.items.map(item => /*#__PURE__*/_jsxs(\"div\", {\n            className: classes.column,\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              className: classes.cartMainPart,\n              children: [/*#__PURE__*/_jsx(\"img\", {\n                src: item.img\n              }), /*#__PURE__*/_jsx(\"p\", {\n                children: item.name\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: classes.cartInfor,\n              children: [\"NT$ \", item.price]\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: classes.cartInfor,\n              children: item.quantity\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: classes.cartInfor,\n              children: [\"NT$ \", item.totalPrice]\n            })]\n          }, item.id))]\n        })]\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: classes.custinforContainer,\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: classes.custHeaderColumn,\n            children: /*#__PURE__*/_jsx(\"div\", {\n              children: \"\\u9867\\u5BA2\\u8CC7\\u8A0A\"\n            })\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: classes.column,\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              className: classes.custColumn,\n              children: [/*#__PURE__*/_jsx(\"p\", {\n                children: \"\\u9867\\u5BA2\\u59D3\\u540D\"\n              }), /*#__PURE__*/_jsx(\"input\", {\n                defaultValue: \"\\u912D\\u4F0A\\u5A77\",\n                ref: name\n              }), isFormInvalid.nameState && /*#__PURE__*/_jsx(\"p\", {\n                className: classes.invalid,\n                children: \"\\u8ACB\\u8F38\\u5165\\u59D3\\u540D\"\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: classes.custColumn,\n              children: [/*#__PURE__*/_jsx(\"p\", {\n                children: \"\\u96FB\\u5B50\\u4FE1\\u7BB1\"\n              }), /*#__PURE__*/_jsx(\"input\", {\n                defaultValue: \"bz850308@gmail.com\",\n                type: \"email\",\n                ref: email\n              }), isFormInvalid.emailState && /*#__PURE__*/_jsx(\"p\", {\n                className: classes.invalid,\n                children: \"\\u8ACB\\u8F38\\u5165Email\"\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: classes.custColumn,\n              children: [/*#__PURE__*/_jsx(\"p\", {\n                children: \"\\u96FB\\u8A71\\u865F\\u78BC\"\n              }), /*#__PURE__*/_jsx(\"input\", {\n                ref: phone,\n                maxLength: \"10\"\n              }), isFormInvalid.phoneState && /*#__PURE__*/_jsx(\"p\", {\n                className: classes.invalid,\n                children: \"\\u8ACB\\u8F38\\u5165\\u96FB\\u8A71\"\n              })]\n            })]\n          })]\n        })\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: classes.custinforContainer,\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: classes.custHeaderColumn,\n            children: /*#__PURE__*/_jsx(\"div\", {\n              children: \"\\u4ED8\\u6B3E\\u8CC7\\u6599\"\n            })\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: classes.column,\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              className: classes.custColumn,\n              children: [/*#__PURE__*/_jsx(\"p\", {\n                children: \"\\u5361\\u865F\"\n              }), /*#__PURE__*/_jsx(\"input\", {\n                type: \"number\",\n                ref: cardNumber\n              }), isFormInvalid.cardNumberState && /*#__PURE__*/_jsx(\"p\", {\n                className: classes.invalid,\n                children: \"\\u8ACB\\u8F38\\u5165\\u5361\\u865F\"\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: classes.custColumn,\n              children: [/*#__PURE__*/_jsx(\"p\", {\n                children: \"\\u6301\\u5361\\u4EBA\\u59D3\\u540D\"\n              }), /*#__PURE__*/_jsx(\"input\", {\n                ref: cardOwner\n              }), isFormInvalid.cardOwnerState && /*#__PURE__*/_jsx(\"p\", {\n                className: classes.invalid,\n                children: \"\\u8ACB\\u8F38\\u5165\\u6301\\u5361\\u4EBA\\u59D3\\u540D\"\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: classes.custColumn,\n              children: [/*#__PURE__*/_jsx(\"p\", {\n                children: \"\\u6709\\u6548\\u65E5\\u671F(MM/YY)\"\n              }), /*#__PURE__*/_jsx(\"input\", {\n                ref: cardDate\n              }), isFormInvalid.cardDateState && /*#__PURE__*/_jsx(\"p\", {\n                className: classes.invalid,\n                children: \"\\u8ACB\\u8F38\\u5165\\u6709\\u6548\\u65E5\\u671F\"\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: classes.custColumn,\n              children: [/*#__PURE__*/_jsx(\"p\", {\n                children: \"\\u5B89\\u5168\\u78BC\"\n              }), /*#__PURE__*/_jsx(\"input\", {\n                type: \"number\",\n                ref: saftyNumber,\n                maxLength: \"3\"\n              }), isFormInvalid.saftyNumberState && /*#__PURE__*/_jsx(\"p\", {\n                className: classes.invalid,\n                children: \"\\u8ACB\\u8F38\\u5165\\u5B89\\u5168\\u78BC\"\n              })]\n            })]\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: classes.custHeaderColumn,\n            children: /*#__PURE__*/_jsx(\"div\", {\n              children: \"\\u9001\\u8CA8\\u8CC7\\u6599\"\n            })\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: classes.column,\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              className: classes.custColumn,\n              children: [/*#__PURE__*/_jsx(\"p\", {\n                children: \"\\u6536\\u4EF6\\u4EBA\\u540D\\u7A31\"\n              }), /*#__PURE__*/_jsx(\"input\", {\n                defaultValue: \"\\u912D\\u4F0A\\u5A77\",\n                ref: sendName\n              }), isFormInvalid.sendNameState && /*#__PURE__*/_jsx(\"p\", {\n                className: classes.invalid,\n                children: \"\\u8ACB\\u8F38\\u5165\\u6536\\u4EF6\\u4EBA\\u540D\\u7A31\"\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: classes.custColumn,\n              children: [/*#__PURE__*/_jsx(\"p\", {\n                children: \"\\u6536\\u4EF6\\u4EBA\\u96FB\\u8A71\\u865F\\u78BC\"\n              }), /*#__PURE__*/_jsx(\"input\", {\n                ref: sendPhone,\n                maxLength: \"10\"\n              }), isFormInvalid.sendPhoneState && /*#__PURE__*/_jsx(\"p\", {\n                className: classes.invalid,\n                children: \"\\u8ACB\\u8F38\\u5165\\u6536\\u4EF6\\u4EBA\\u96FB\\u8A71\\u865F\\u78BC\"\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: classes.custColumn,\n              children: [/*#__PURE__*/_jsx(\"p\", {\n                children: \"\\u9001\\u8CA8\\u65B9\\u5F0F\"\n              }), /*#__PURE__*/_jsx(\"input\", {\n                defaultValue: \"\\u5B85\\u914D\",\n                ref: sendWay\n              }), isFormInvalid.sendWayState && /*#__PURE__*/_jsx(\"p\", {\n                className: classes.invalid,\n                children: \"\\u8ACB\\u8F38\\u5165\\u9001\\u8CA8\\u65B9\\u5F0F\"\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: classes.custColumn,\n              children: [/*#__PURE__*/_jsx(\"p\", {\n                children: \"\\u9001\\u8CA8\\u5730\\u5740\"\n              }), /*#__PURE__*/_jsx(\"input\", {\n                ref: sendAddr\n              }), isFormInvalid.sendAddrState && /*#__PURE__*/_jsx(\"p\", {\n                className: classes.invalid,\n                children: \"\\u8ACB\\u8F38\\u5165\\u9001\\u8CA8\\u5730\\u5740\"\n              })]\n            })]\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: classes.custHeaderColumn,\n            children: /*#__PURE__*/_jsx(\"div\", {\n              children: \"\\u767C\\u7968\\u8CC7\\u8A0A\"\n            })\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: classes.column,\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              className: classes.custColumn,\n              children: [/*#__PURE__*/_jsx(\"p\", {\n                children: \"\\u767C\\u7968\\u985E\\u578B\"\n              }), /*#__PURE__*/_jsx(\"select\", {\n                ref: recieptType,\n                defaultValue: \"\\u96F2\\u7AEF\\u767C\\u7968\",\n                children: /*#__PURE__*/_jsx(\"option\", {\n                  children: \"\\u96F2\\u7AEF\\u767C\\u7968\"\n                })\n              }), isFormInvalid.recieptTypeState && /*#__PURE__*/_jsx(\"p\", {\n                className: classes.invalid,\n                children: \"\\u8ACB\\u9078\\u64C7\\u96F2\\u7AEF\\u767C\\u7968\"\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: classes.custColumn,\n              children: [/*#__PURE__*/_jsx(\"p\", {\n                children: \"\\u8F38\\u5165\\u8F09\\u5177\"\n              }), /*#__PURE__*/_jsx(\"input\", {\n                ref: reciept\n              }), isFormInvalid.recieptState && /*#__PURE__*/_jsx(\"p\", {\n                className: classes.invalid,\n                children: \"\\u8ACB\\u8F38\\u5165\\u8F09\\u5177\"\n              })]\n            })]\n          })]\n        })]\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: classes.bottomContainer,\n        children: /*#__PURE__*/_jsx(GreenButton, {\n          title: \"\\u9001\\u51FA\\u8A02\\u55AE\",\n          width: \"200px\",\n          onClick: comfirmDataHandler\n        })\n      })]\n    })]\n  });\n};\n\nexport default index;","map":null,"metadata":{},"sourceType":"module"}